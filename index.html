<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat mit Gyro-Effekt (Dark Mode)</title>
  <style>
    :root {
      --accent: #00ffae;
      --secondary: #2b2b2b;
      --bg: #0e0e0e;
      --text: #f0f0f0;
    }

    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    .toggle-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      color: var(--text);
    }

    .chat {
      width: 100%;
      max-width: 600px;
    }

    .msg-rx,
    .msg-tx {
      display: flex;
      align-items: center;
      margin-block: .6rem;
    }

    .msg-rx {
      justify-content: flex-start;
    }

    .msg-tx {
      justify-content: flex-end;
    }

    .msg-content-rx,
    .msg-content-tx {
      padding-inline: 14px;
      padding-block: 8px;
      border-radius: 16px;
      max-width: 80vw;
      transition: box-shadow 0.2s ease, transform 0.2s ease;
    }

    .msg-content-rx {
      background-color: var(--secondary);
      color: var(--text);
      margin-left: 12px;
      box-shadow: 0 0 14px rgba(255, 255, 255, 0.05);
    }

    .msg-content-tx {
      background-color: var(--accent);
      color: #000;
      margin-right: 12px;
      box-shadow: 0 0 25px rgba(0, 255, 174, 0.4);
    }

    /* Toggle switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #555;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--accent);
    }

    input:checked + .slider:before {
      transform: translateX(24px);
    }
  </style>
</head>
<body>

  <div class="toggle-container">
    <label class="switch">
      <input type="checkbox" id="gyroToggle">
      <span class="slider"></span>
    </label>
    <span>Gyro-Effekt aktivieren</span>
  </div>

  <div class="chat">
    <div class="msg-rx">
      <div class="msg-content-rx">Hi!</div>
    </div>
    <div class="msg-tx">
      <div class="msg-content-tx">Hey! Wie gehtâ€™s dir?</div>
    </div>
    <div class="msg-tx">
      <div class="msg-content-tx">Lorem ipsum dolor sit amet consectetur adipisicing elit. Doloremque fugit nulla corporis!</div>
    </div>
    <div class="msg-rx">
      <div class="msg-content-rx">Nice, gefÃ¤llt mir ðŸ˜„</div>
    </div>
    <div class="msg-rx">
      <div class="msg-content-rx">Hi!</div>
    </div>
    <div class="msg-tx">
      <div class="msg-content-tx">Hey! Wie gehtâ€™s dir?</div>
    </div>
    <div class="msg-tx">
      <div class="msg-content-tx">Lorem ipsum dolor sit amet consectetur adipisicing elit. Doloremque fugit nulla corporis!</div>
    </div>
    <div class="msg-rx">
      <div class="msg-content-rx">Nice, gefÃ¤llt mir ðŸ˜„</div>
    </div>
    <div class="msg-rx">
      <div class="msg-content-rx">Hi!</div>
    </div>
    <div class="msg-tx">
      <div class="msg-content-tx">Hey! Wie gehtâ€™s dir?</div>
    </div>
    <div class="msg-tx">
      <div class="msg-content-tx">Lorem ipsum dolor sit amet consectetur adipisicing elit. Doloremque fugit nulla corporis!</div>
    </div>
    <div class="msg-rx">
      <div class="msg-content-rx">Nice, gefÃ¤llt mir ðŸ˜„</div>
    </div>
    <div class="msg-rx">
      <div class="msg-content-rx">Hi!</div>
    </div>
    <div class="msg-tx">
      <div class="msg-content-tx">Hey! Wie gehtâ€™s dir?</div>
    </div>
    <div class="msg-tx">
      <div class="msg-content-tx">Lorem ipsum dolor sit amet consectetur adipisicing elit. Doloremque fugit nulla corporis!</div>
    </div>
    <div class="msg-rx">
      <div class="msg-content-rx">Nice, gefÃ¤llt mir ðŸ˜„</div>
    </div>
  </div>

<script>
  const toggle = document.getElementById('gyroToggle');
  const rxMessages = document.querySelectorAll('.msg-content-rx');
  const txMessages = document.querySelectorAll('.msg-content-tx');
  let gyroActive = false;
  let betaZero = 0;
  let gammaZero = 0;

  // --- Gyro-Effekt ---
  function handleOrientation(event) {
    if (!gyroActive) return;

    const beta = event.beta || 0;
    const gamma = event.gamma || 0;

    const betaAdjusted = beta - betaZero;
    const gammaAdjusted = gamma - gammaZero;

    // ---- EffektstÃ¤rke stÃ¤rker ----
    const xOffset = Math.max(-40, Math.min(40, gammaAdjusted * 2)); // vorher 1.2
    const yOffset = Math.max(-40, Math.min(40, betaAdjusted * 1.5)); // vorher 1

    rxMessages.forEach(msg => {
      msg.style.boxShadow = `${xOffset / 3}px ${yOffset / 3}px 35px rgba(255, 255, 255, 0.2)`;
      msg.style.transform = `translate(${xOffset / 6}px, ${yOffset / 6}px)`;
    });

    txMessages.forEach(msg => {
      msg.style.boxShadow = `${-xOffset / 3}px ${-yOffset / 3}px 50px rgba(0, 255, 174, 0.7)`;
      msg.style.transform = `translate(${-xOffset / 6}px, ${-yOffset / 6}px)`;
    });
  }

  function calibrateGyro() {
    return new Promise(resolve => {
      let samples = [];
      const collect = (event) => {
        samples.push({ beta: event.beta, gamma: event.gamma });
        if (samples.length >= 20) {
          window.removeEventListener('deviceorientation', collect);
          betaZero = samples.reduce((a, b) => a + b.beta, 0) / samples.length;
          gammaZero = samples.reduce((a, b) => a + b.gamma, 0) / samples.length;
          resolve();
        }
      };
      window.addEventListener('deviceorientation', collect);
    });
  }

  toggle.addEventListener('change', async () => {
    gyroActive = toggle.checked;

    if (gyroActive && typeof DeviceOrientationEvent.requestPermission === 'function') {
      try {
        const permission = await DeviceOrientationEvent.requestPermission();
        if (permission !== 'granted') {
          alert('Bitte erlaube den Zugriff auf den Bewegungssensor.');
          toggle.checked = false;
          gyroActive = false;
          return;
        }
      } catch (err) {
        console.error(err);
        alert('Sensor konnte nicht aktiviert werden.');
        toggle.checked = false;
        gyroActive = false;
        return;
      }
    }

    if (gyroActive) {
      await calibrateGyro();
      window.addEventListener('deviceorientation', handleOrientation);
    } else {
      window.removeEventListener('deviceorientation', handleOrientation);
      rxMessages.forEach(msg => {
        msg.style.boxShadow = "0 0 14px rgba(255,255,255,0.05)";
        msg.style.transform = "translate(0,0)";
      });
      txMessages.forEach(msg => {
        msg.style.boxShadow = "0 0 25px rgba(0,255,174,0.4)";
        msg.style.transform = "translate(0,0)";
      });
    }
  });

  // --- Kamera-Helligkeit fÃ¼r Ambient-Look ---
  const video = document.createElement('video');
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');

  async function initCamera() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
      video.srcObject = stream;
      video.play();
      requestAnimationFrame(updateBrightness);
    } catch (err) {
      console.warn('Kamera konnte nicht gestartet werden:', err);
    }
  }

  function getAverageBrightness() {
    const width = 32;
    const height = 32;
    canvas.width = width;
    canvas.height = height;
    ctx.drawImage(video, 0, 0, width, height);
    const imageData = ctx.getImageData(0, 0, width, height).data;
    let total = 0;
    for (let i = 0; i < imageData.length; i += 4) {
      // Helligkeit = 0.299*R + 0.587*G + 0.114*B
      total += 0.299 * imageData[i] + 0.587 * imageData[i + 1] + 0.114 * imageData[i + 2];
    }
    return total / (width * height);
  }

  function updateBrightness() {
    const avg = getAverageBrightness(); // 0..255
    // Map 0..255 auf 0.05..0.25 fÃ¼r Hintergrundhelligkeit
    const brightness = 0.05 + (avg / 255) * 0.2;
    document.body.style.backgroundColor = `rgba(14,14,14,${brightness + 0.8})`; // smooth-ish
    requestAnimationFrame(updateBrightness);
  }

  initCamera();
</script>


</body>
</html>
